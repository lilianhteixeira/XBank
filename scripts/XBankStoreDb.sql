-- Criação do banco

CREATE DATABASE XBankStoreDb
GO

USE XBankStoreDb
GO


-- Tabela de Clientes

SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TB_CLIENT](
	[ID] [uniqueidentifier] NOT NULL,
	[NM_NAME] [nvarchar](max) NULL,
	[NM_CPF] [nvarchar](450) NULL,
	[NM_EMAIL] [nvarchar](max) NULL,
	[NM_ADDRESS] [nvarchar](max) NULL,
	[NR_PHONE] [nvarchar](max) NULL,
	[DT_CREATED] [smalldatetime] NOT NULL,
	[DT_UPDATED] [smalldatetime] NOT NULL,
	[ST_ACTIVE] [bit] NOT NULL,
 CONSTRAINT [PK_TB_CLIENT] PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
GO
SET ANSI_PADDING ON
GO
CREATE UNIQUE NONCLUSTERED INDEX [IX_CPF] ON [dbo].[TB_CLIENT]
(
	[NM_CPF] ASC
)
WHERE ([NM_CPF] IS NOT NULL)
WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO

-- Tabela de Contas

SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TB_ACCOUNT](
	[ID] [uniqueidentifier] NOT NULL,
	[ID_CLIENT] [uniqueidentifier] NOT NULL,
	[VL_BALANCE] [money] NOT NULL,
	[DT_CREATED] [smalldatetime] NOT NULL,
	[DT_UPDATED] [smalldatetime] NOT NULL,
	[ST_ACTIVE] [bit] NOT NULL,
 CONSTRAINT [PK_TB_ACCOUNT] PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
CREATE UNIQUE NONCLUSTERED INDEX [IX_TB_ACCOUNT_ID_CLIENT] ON [dbo].[TB_ACCOUNT]
(
	[ID_CLIENT] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
ALTER TABLE [dbo].[TB_ACCOUNT]  WITH CHECK ADD  CONSTRAINT [FK_TB_ACCOUNT_TB_CLIENT_ID_CLIENT] FOREIGN KEY([ID_CLIENT])
REFERENCES [dbo].[TB_CLIENT] ([ID])
ON DELETE CASCADE
GO
ALTER TABLE [dbo].[TB_ACCOUNT] CHECK CONSTRAINT [FK_TB_ACCOUNT_TB_CLIENT_ID_CLIENT]
GO


-- Tabela de movimentações

SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TB_MOVEMENT](
	[ID] [uniqueidentifier] NOT NULL,
	[ID_ACCOUNT] [uniqueidentifier] NOT NULL,
	[VL_MOVEMENT_VALUE] [decimal](18, 2) NOT NULL,
	[NR_CPF_SEND] [nvarchar](max) NULL,
	[NM_ORIGIN] [nvarchar](max) NULL,
	[NM_TYPE] [int] NOT NULL,
	[DT_CREATED] [smalldatetime] NOT NULL,
	[DT_UPDATED] [smalldatetime] NOT NULL,
	[ST_ACTIVE] [bit] NOT NULL,
 CONSTRAINT [PK_TB_MOVEMENT] PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
GO
CREATE NONCLUSTERED INDEX [IX_TB_MOVEMENT_ID_ACCOUNT] ON [dbo].[TB_MOVEMENT]
(
	[ID_ACCOUNT] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
ALTER TABLE [dbo].[TB_MOVEMENT]  WITH CHECK ADD  CONSTRAINT [FK_TB_MOVEMENT_TB_ACCOUNT_ID_ACCOUNT] FOREIGN KEY([ID_ACCOUNT])
REFERENCES [dbo].[TB_ACCOUNT] ([ID])
ON DELETE CASCADE
GO
ALTER TABLE [dbo].[TB_MOVEMENT] CHECK CONSTRAINT [FK_TB_MOVEMENT_TB_ACCOUNT_ID_ACCOUNT]
GO

-- Dados para teste

-- Clientes
INSERT INTO [dbo].[TB_CLIENT]
(
	[ID], [NM_NAME], [NM_CPF], [NM_EMAIL], [NM_ADDRESS], [NR_PHONE], [DT_CREATED], [DT_UPDATED], [ST_ACTIVE]
)
VALUES
( 
	'6f9d579c-a3df-4987-8002-0a1a869cf401', 'Rosetta', '49293963019', 'email@xpi.com.br', 'Rua dos Bancos n 333', '(11) 96351-7296', '2021-11-17 16:44:00', '2021-11-17 16:44:00', 1
),
(
	'0c3b82a0-b6bd-43f7-bb99-c3ecec63ae6d', 'Jokan Armando', '47058792011', 'emai@lxpi.com.br', 'Rua dos Bancos n 999', '(11) 96351-7456',	'2021-11-17 16:29:00', '2021-11-17 16:29:00', 1
)
GO

-- Contas
INSERT INTO [dbo].[TB_ACCOUNT]
(
	[ID], [ID_CLIENT], [VL_BALANCE], [DT_CREATED], [DT_UPDATED], [ST_ACTIVE]
)
VALUES
( 
	'9c4b7f61-708a-4cd4-a42e-080847d7d5be', '0c3b82a0-b6bd-43f7-bb99-c3ecec63ae6d', 10, '2021-11-17 16:29:00', '2021-11-17 17:28:00', 1
),
(
	'acdc7b38-27af-4c80-9ddc-a389d37ed585', '6f9d579c-a3df-4987-8002-0a1a869cf401', 5, '2021-11-17 16:44:00', '2021-11-17 17:28:00', 1
)
GO

-- Movimentações
INSERT INTO [dbo].[TB_MOVEMENT]
(
	[ID], [ID_ACCOUNT], [VL_MOVEMENT_VALUE], [NR_CPF_SEND], [NM_ORIGIN], [NM_TYPE], [DT_CREATED], [DT_UPDATED], [ST_ACTIVE]									
)
VALUES
( 
	'08ab0df1-6385-429a-a0ff-41caf243d19a', '9c4b7f61-708a-4cd4-a42e-080847d7d5be',	25, '47058792011', 'ATM', 4, '2021-11-17 16:32:00', '2021-11-17 16:32:00', 1
),
(
	'1940244c-542f-4cd0-badb-6928b43d23e0', '9c4b7f61-708a-4cd4-a42e-080847d7d5be',	5, '47058792011', 'ATM', 1, '2021-11-17 16:44:00', '2021-11-17 16:44:00', 1
),
(
	'ef33b2c9-e5a6-4946-85e1-b47249013764',	'9c4b7f61-708a-4cd4-a42e-080847d7d5be',	5, '49293963019', '47058792011', 3, '2021-11-17 17:28:00', '2021-11-17 17:28:00', 1
),
(
	'c5231ce9-9688-4e90-af19-c7341da7dee5', '9c4b7f61-708a-4cd4-a42e-080847d7d5be', 5, '49293963019', '47058792011', 2, '2021-11-17 17:28:00', '2021-11-17 17:28:00', 1
),
(
	'a2470e77-2359-415a-960c-f2c6a942839f', 'acdc7b38-27af-4c80-9ddc-a389d37ed585',	5, '49293963019', '47058792011', 4, '2021-11-17 17:28:00', '2021-11-17 17:28:00', 1
)
GO